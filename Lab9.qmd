---
title: "Class 9: Structural Bioinformatics pt. 1"
author: "Jada Brown (PID: A15573784)"
format: pdf
---

## The main repository for biomolecular structure data is the Protein Data Bank (PDB) https://www.rcsb.org/

Lets have a quick look at the composition of this database:
```{r}
data <- read.csv("./Data Export Summary.csv")
```

```{r}
data
```

```{r}
as.numeric(sub(",", "", data$X.ray))
as.numeric(sub(",", "", data$EM))
```
This is annoying, lets try a different import function from the ***readr*** package.
Function is read_ -> will result in dbl

```{r}
library(readr)

data <- read_csv("./Data Export Summary.csv")
data
```


> Q1: What percentage of structures in the PDB are solved by X-Ray and Electron Microscopy.

```{r}
n.total <- sum(data$Total)
n.xray <- sum(data$`X-ray`)
n.em <- sum(data$EM)

perX <- round(n.xray/n.total * 100, 2)
perEm <- round(n.em/n.total * 100, 2)

perX
perEm
```


> Q2: What proportion of structures in the PDB are protein?





> Make a bar plot overview.

```{r}
library(ggplot2)

ggplot(data) + aes(reorder(`Molecular Type`, -Total), Total,  label = Total, col = `Molecular Type`) + geom_text() + geom_col()
```

## Visualizing structure data

The Mol* viewer is embedded in many bioinformatics websites. The homepage is: https://molstar.org/

![The HIV-Pr dimer with bound inhibitor](1HSG.png)
Add water 308 and lumpy version of protein


## Bio3D Package for structural bioinformatics
We can use the bio3d package to read and analyze biomolecular data in R:

```{r}
library(bio3d)

hiv <- read.pdb("1hsg")
hiv
```

```{r}
head(hiv$atom)
```


Lets get the sequence
```{r}
pdbseq(hiv)
```
Lets trim to chain A and get just it's sequence:
```{r}
chainA <- trim.pdb(hiv, chain = "A")
chain.A.Seq <- pdbseq(chainA)
```

Let's blast

```{r blast_hiv, cache=TRUE}
blast <- blast.pdb(chain.A.Seq)
```

```{r}
head(blast$hit.tbl)
```

Plot a quick overview of blast results

```{r}
hits <-plot(blast)
```

```{r}
hits$pdb.id
```

## Prediction of functional motions

We can run a Normal Model Analysis (NMA) to predict large scale motions/flexibility/dynamics of any biomolecule that we can read into R.

Let's look ADK and chain A only

```{r}
adk <- read.pdb("1ake")
adk_A <- trim.pdb(adk, chain = "A")
adk_A
```

```{r}
m <- nma(adk_A)
plot(m)
```

Let's write out a "trajectory" of predicted motion
```{r}
mktrj(m, file = "adk_nma.pdb")
```


## Play with 3D viewing in R

We can use the new **bio3dview** package, which is not yet on CRAN, to render interactive 3D views in R and HTML quarto output reports.

To install from Github we can use the **pak** package. 

render here


## Comparative Analysis of protein structures

Starting with a sequence or structure ID (accession number) let's run a complete analysis pipeline

```{r}
library(bio3d)

id <- "1ake_A"

aa <- get.seq(id)

aa
```

```{r, cache=TRUE}
blast <- blast.pdb(aa)
hits <- plot(blast)
```

```{r}
hits$pdb.id
```


Download all these "hits" that are similar tp our starting id sequence
```{r}
files <- get.pdb(hits$pdb.id, path="pdbs", split=TRUE, gzip=TRUE)
```

```{r}
library(BiocManager
        )
pdbs <- pdbaln(files, fit = TRUE, exefile="msa")
```

```{r}
pc.xray <- pca(pdbs)
plot(pc.xray)
```

```{r}
plot(pc.xray, 1:2)
```


```{r}
mktrj(pc.xray, file = "pc_results.pdb")
```


```{r}
ids <- basename.pdb(pdbs$id)
```

```{r}
plot(pdbs, labels=ids)
```

